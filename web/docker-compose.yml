services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    image: seanchangx/qbit-backend:latest
    container_name: qbit-backend
    restart: unless-stopped
    env_file: .env
    expose:
      - "3001"
      - "3002"
    ports:
      # 3002 = admin (restrict to internal network via firewall; do not expose to internet)
      - "3002:3002"
    environment:
      - PORT=3001
      - ADMIN_PORT=3002
      - ADMIN_HOST=0.0.0.0
      - DEVICE_API_KEY=${DEVICE_API_KEY:-}
      - MAX_DEVICE_CONNECTIONS=${MAX_DEVICE_CONNECTIONS:-100}
    volumes:
      - qbit-data:/data

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
    image: seanchangx/qbit-frontend:latest
    container_name: qbit-frontend
    restart: unless-stopped
    ports:
      - "3000:80"

volumes:
  qbit-data:
